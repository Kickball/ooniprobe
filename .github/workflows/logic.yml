---

name: logic

on:
  push:
#    branches:
#      - main
    tags:
      - '*'

jobs:

  config:
    name: "Config"
    uses: ./.github/workflows/_config.yml

  build:
    uses: ./.github/workflows/build.yml
    needs: [config]
    with:
      platforms: ${{ needs.metadata.outputs.platforms }}
      image_tags: ${{ needs.metadata.outputs.image_tags }}
      build_args: |
        OONIPROBE_VERSION=${{ needs.metadata.outputs.version }}
    secrets:
      dockerhub_username: ${{ secrets.DOCKERHUB_USERNAME }}
      dockerhub_token: ${{ secrets.DOCKERHUB_TOKEN }}